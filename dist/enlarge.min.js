/*! fg-enlarge - v0.3.1 - 2018-08-15
* Copyright (c) 2018 Scott Jehl, Filament Group, Inc.; Licensed MIT */

!function(j){var e=function(){var L=j.jQuery,R="enlarge";L.fn[R]=function(I){var N,O=arguments,F=L(this).data("options")||{button:!0,hoverZoomWithoutClick:!0,delay:300,flyout:{width:300,height:300},placement:"inline",magnification:3};"string"!=typeof I&&(F=L.extend(F,I),L(this).data("options",F));var e=this.each(function(){var o=L(this),a=this,e=j.document.createElement("img"),i="srcset"in e&&"sizes"in e,t=L(this).find("a");if(!t.length)throw new Error(R+": requires an anchor element with `href` for the enlarged image source");var n=o.find("img")[0],m=n,d=m.src,s=L(m).attr("srcset"),l=L(m).attr("sizes"),r=t[0].href,c=(t[0].innerText,R+"-zoomed"),f=R+"-delay",u=L(m).closest(".enlarge_contain"),h=u,p=L(m).closest(".enlarge_pane")||o,g=L(this).data("zoomParent")||p;L(this).data("zoomParent",g);var v=o.data("zoomed")||!1;o.data("zoomed",v),o.data("lockedZoom",o.data("lockedZoom")||!1);var y=R+"-locked";if(!u.length)throw new Error(R+": requires an element above the image marked with the class `enlarge_contain`");if("string"!=typeof I){var k,b,z,C;P(),o.data("updateOptions",function(e){F=L.extend(F,e),L(this).data("options",F),W(),_(),w=F.hoverZoomWithoutClick,F.image&&F.image.sizes&&(l=F.image.sizes,T()),P(),F.disabled&&o.data("zoomed")&&B()});var w=F.hoverZoomWithoutClick,Z=L('<div class="enlarge_flyout"></div>').append(u.clone());Z.insertAfter(p),u.append('<i class="enlarge_loader"><i></i></i>'),W(),_(),t.bind("keydown",function(e){var t;13!==e.keyCode&&32!==e.keyCode||"inline"!==(t=F.placement)&&(L(a).bind(R+".after-zoom-out",function e(){F.placement=t,W(),L(a).unbind(R+".after-zoom-out",e)}),F.placement="inline",W()),32===e.keyCode&&(e.preventDefault(),L(this).trigger("click"))}).bind("click",function(e){e.preventDefault(),B()}),L(j).bind("resize",function(e){o.data("lockedZoom")&&B()}),L(j.document).bind("mouseup",function(e){o.data("lockedZoom")&&!L(e.target).closest(p).length&&B()}),L(n).bind("mouseenter touchstart",function(e){"touchstart"===e.type&&(C=!0),C&&"mouseenter"===e.type||"mouseenter"===e.type&&!C&&!w||o.data("lockedZoom")||z||(z=!0,u.addClass(f),b=setTimeout(function(){u.removeClass(f),D(),T(function(){q(),k=!0,E(e)})},F.delay))}).bind("mousemove touchmove",E).bind("mouseleave touchend",function(e){var t;z=!1,v&&!o.data("lockedZoom")&&(D(),T(function(){q()})),t=e,u.removeClass(f),clearTimeout(b),(k=!1)!==F.hoverZoomWithoutClick||C||(w=!1),C&&"mouseleave"===t.type&&(C=!1)}).bind("click",function(e){e.preventDefault(),C&&"inline"===F.placement&&B(),!1!==F.hoverZoomWithoutClick||C||((w=!w)?L(this).trigger("mouseenter"):L(this).trigger("mouseleave"))}),L(this).bind("keydown keyup",function(e){37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode?(e.stopImmediatePropagation(),o.data("lockedZoom")||e.preventDefault()):"keyup"===e.type&&L(this).data("lockedZoom")&&27===e.keyCode&&(B(),t[0].focus(),e.stopImmediatePropagation())}),p.bind("scroll",function(){o.data("zoomed")&&(D(),T(function(){o.data("lockedZoom")&&A(),q()}))})}else{var x=Array.prototype.slice.call(O,1);switch(I){case"in":o.data("zoomed")||B();break;case"out":o.data("zoomed")&&B();break;case"isZoomed":N=o.data("zoomed");break;case"updateOptions":o.data("updateOptions")(x[0])}}function W(){"inline"===F.placement?(m=n,g=p,o.data("zoomParent",g),h=u):(m=Z.find("img")[0],g=h=Z,o.data("zoomParent",g))}function _(){Z.css({width:F.flyout.width+"px",height:F.flyout.height+"px",top:"",left:"","margin-left":"","margin-top":""});var e=F.placement.match(/left|right/);e&&(Z.css(e[0],-F.flyout.width-10+"px"),Z.css("top","0")),F.placement.match(/loupe/)&&Z.css({"margin-left":-F.flyout.width/2+"px","margin-top":-F.flyout.height/2+"px"}),Z[0].className=Z[0].className.replace(/enlarge_flyout\-[^$\s]+/," "),Z.addClass("enlarge_flyout-"+F.placement)}function P(){F.disabled?o.addClass("enlarge_disabled"):o.removeClass("enlarge_disabled")}function D(){v=!o.data("zoomed"),o.data("zoomed",v)}function T(e){if(e=e||function(){},v){if(F.disabled)return e(),!1;var t=new Image;t.className="enlarge_img-loading",t.onload=function(){m.sizes=t.sizes,i&&s||(m.src=r),L(t).remove(),e()},t.sizes=H()+"px",i&&s?s&&(t.srcset=s):t.src=r,L(t).insertBefore(m)}else m.sizes=l,i||(m.src=d),e()}function A(){if(o.data("lockedZoom"))p.add(g).removeClass(y),o.data("lockedZoom",lockedZoom=!1),h.removeAttr("tabindex");else{if(F.disabled)return!1;p.add(g).addClass(y),o.data("lockedZoom",lockedZoom=!0),h.attr("tabindex","0"),h[0].focus()}}function H(){return p[0].offsetWidth*F.magnification}function q(){if(o.data("zoomed")){if(F.disabled)return!1;"inline"===F.placement&&u.add(p).css({width:p[0].offsetWidth+"px",height:parseFloat(getComputedStyle(p[0]).height)+"px"}),g.addClass(c),L(m).css("width",H()+"px"),L(a).trigger(R+".after-zoom-in")}else g.removeClass(c),"inline"===F.placement&&u.add(p).css({width:"",height:""}),L(m).css("width",""),L(a).trigger(R+".after-zoom-out")}function B(){if(F.disabled&&!o.data("zoomed"))return!1;D(),T(function(){var e,t,o,a;A(),q(),e=h.width(),t=h.height(),o=m.offsetWidth,a=m.offsetHeight,h[0].scrollLeft=o/2-e/2,h[0].scrollTop=a/2-t/2})}function E(e){if(k){if(C&&"mousemove"===e.type)return;var t=e.touches?e.touches[0]:e;e.preventDefault();var o=t.clientX-u[0].getBoundingClientRect().left,a=t.clientY-u[0].getBoundingClientRect().top;if(F.placement.match(/loupe/)){var i=(e.touches?-F.flyout.width/1.3:-F.flyout.width/2)+"px",n=(e.touches?-F.flyout.height/1.3:-F.flyout.height/2)+"px";requestAnimationFrame(function(){Z.css({top:a+"px",left:o+"px","margin-left":i,"margin-top":n})})}var d=u[0].offsetWidth,s=u[0].offsetHeight,l=m.offsetWidth,r=m.offsetHeight,c=h[0].offsetWidth,f=h[0].offsetHeight;h[0].scrollLeft=o/d*(l-c),h[0].scrollTop=a/s*(r-f)}}});return void 0!==N?N:e}};"undefined"!=typeof module?module.exports=e:e()}("undefined"!=typeof global?global:this);