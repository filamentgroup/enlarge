/*! fg-enlarge - v0.3.1 - 2018-08-16
* Copyright (c) 2018 Scott Jehl, Filament Group, Inc.; Licensed MIT */

!function(j){var t={hoverZoomWithoutClick:!0,delay:300,flyout:{width:300,height:300},placement:"flyoutright",magnification:3},e=function(){var L=j.jQuery,R="enlarge";L.fn[R]=function(){var N,O=arguments,F=L(this).data("options");"string"!=typeof F&&(o=L.extend({},t,F),L(this).data("options",o));var e=this.each(function(){var a=L(this),i=this,e=j.document.createElement("img"),n="srcset"in e&&"sizes"in e,t=L(this).find("a");if(!t.length)throw new Error(R+": requires an anchor element with `href` for the enlarged image source");var d=a.find("img")[0],h=d,s=h.src,l=L(h).attr("srcset"),r=L(h).attr("sizes"),c=t[0].href,f=(t[0].innerText,R+"-zoomed"),m=R+"-delay",p=L(h).closest(".enlarge_contain"),g=p,u=L(h).closest(".enlarge_pane")||a,v=L(this).data("zoomParent")||u;L(this).data("zoomParent",v);var y=a.data("zoomed")||!1;a.data("zoomed",y),a.data("lockedZoom",a.data("lockedZoom")||!1);var k=R+"-locked";if(!p.length)throw new Error(R+": requires an element above the image marked with the class `enlarge_contain`");if("string"!=typeof F){var z,b,C,w;D(),a.data("updateOptions",function(e){o=L.extend(o,e),L(this).data("options",o),_(),P(),Z=o.hoverZoomWithoutClick,o.image&&o.image.sizes&&(r=o.image.sizes,A()),D(),o.disabled&&a.data("zoomed")&&B()});var Z=o.hoverZoomWithoutClick,x=L('<div class="enlarge_flyout"></div>').append(p.clone());x.insertAfter(u),p.append('<i class="enlarge_loader"><i></i></i>'),_(),P(),t.bind("keydown",function(e){var t;13!==e.keyCode&&32!==e.keyCode||"inline"!==(t=o.placement)&&(L(i).bind(R+".after-zoom-out",function e(){o.placement=t,_(),L(i).unbind(R+".after-zoom-out",e)}),o.placement="inline",_()),32===e.keyCode&&(e.preventDefault(),L(this).trigger("click"))}).bind("click",function(e){e.preventDefault(),B()}),L(j).bind("resize",function(e){a.data("lockedZoom")&&B()}),L(j.document).bind("mouseup",function(e){a.data("lockedZoom")&&!L(e.target).closest(u).length&&B()}),L(d).bind("mouseenter touchstart",function(e){"touchstart"===e.type&&(w=!0),w&&"mouseenter"===e.type||"mouseenter"===e.type&&!w&&!Z||a.data("lockedZoom")||C||(C=!0,p.addClass(m),b=setTimeout(function(){p.removeClass(m),T(),A(function(){q(),z=!0,I(e)})},o.delay))}).bind("mousemove touchmove",I).bind("mouseleave touchend",function(e){var t;C=!1,y&&!a.data("lockedZoom")&&(T(),A(function(){q()})),t=e,p.removeClass(m),clearTimeout(b),(z=!1)!==o.hoverZoomWithoutClick||w||(Z=!1),w&&"mouseleave"===t.type&&(w=!1)}).bind("click",function(e){e.preventDefault(),w&&"inline"===o.placement&&B(),!1!==o.hoverZoomWithoutClick||w||((Z=!Z)?L(this).trigger("mouseenter"):L(this).trigger("mouseleave"))}),L(this).bind("keydown keyup",function(e){37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode?(e.stopImmediatePropagation(),a.data("lockedZoom")||e.preventDefault()):"keyup"===e.type&&L(this).data("lockedZoom")&&27===e.keyCode&&(B(),t[0].focus(),e.stopImmediatePropagation())}),u.bind("scroll",function(){a.data("zoomed")&&(T(),A(function(){a.data("lockedZoom")&&E(),q()}))})}else{var W=Array.prototype.slice.call(O,1);switch(F){case"in":a.data("zoomed")||B();break;case"out":a.data("zoomed")&&B();break;case"isZoomed":N=a.data("zoomed");break;case"updateOptions":a.data("updateOptions")(W[0])}}function _(){"inline"===o.placement?(h=d,v=u,a.data("zoomParent",v),g=p):(h=x.find("img")[0],v=g=x,a.data("zoomParent",v))}function P(){x.css({width:o.flyout.width+"px",height:o.flyout.height+"px",top:"",left:"","margin-left":"","margin-top":""});var e=o.placement.match(/left|right/);e&&(x.css(e[0],-o.flyout.width-10+"px"),x.css("top","0")),o.placement.match(/loupe/)&&x.css({"margin-left":-o.flyout.width/2+"px","margin-top":-o.flyout.height/2+"px"}),x[0].className=x[0].className.replace(/enlarge_flyout\-[^$\s]+/," "),x.addClass("enlarge_flyout-"+o.placement)}function D(){o.disabled?a.addClass("enlarge_disabled"):a.removeClass("enlarge_disabled")}function T(){y=!a.data("zoomed"),a.data("zoomed",y)}function A(e){if(e=e||function(){},y){if(o.disabled)return e(),!1;var t=new Image;t.className="enlarge_img-loading",t.onload=function(){h.sizes=t.sizes,n&&l||(h.src=c),L(t).remove(),e()},t.sizes=H()+"px",n&&l?l&&(t.srcset=l):t.src=c,L(t).insertBefore(h)}else h.sizes=r,n||(h.src=s),e()}function E(){if(a.data("lockedZoom"))u.add(v).removeClass(k),a.data("lockedZoom",lockedZoom=!1),g.removeAttr("tabindex");else{if(o.disabled)return!1;u.add(v).addClass(k),a.data("lockedZoom",lockedZoom=!0),g.attr("tabindex","0"),g[0].focus()}}function H(){return u[0].offsetWidth*o.magnification}function q(){if(a.data("zoomed")){if(o.disabled)return!1;"inline"===o.placement&&p.add(u).css({width:u[0].offsetWidth+"px",height:parseFloat(getComputedStyle(u[0]).height)+"px"}),v.addClass(f),L(h).css("width",H()+"px"),L(i).trigger(R+".after-zoom-in")}else v.removeClass(f),"inline"===o.placement&&p.add(u).css({width:"",height:""}),L(h).css("width",""),L(i).trigger(R+".after-zoom-out")}function B(){if(o.disabled&&!a.data("zoomed"))return!1;T(),A(function(){var e,t,o,a;E(),q(),e=g.width(),t=g.height(),o=h.offsetWidth,a=h.offsetHeight,g[0].scrollLeft=o/2-e/2,g[0].scrollTop=a/2-t/2})}function I(e){if(z){if(w&&"mousemove"===e.type)return;var t=e.originalEvent||e,a=t.touches?t.touches[0]:t;e.preventDefault();var i=a.clientX-p[0].getBoundingClientRect().left,n=a.clientY-p[0].getBoundingClientRect().top;if(o.placement.match(/loupe/)){var d=(t.touches?-o.flyout.width/1.3:-o.flyout.width/2)+"px",s=(t.touches?-o.flyout.height/1.3:-o.flyout.height/2)+"px";requestAnimationFrame(function(){x.css({top:n+"px",left:i+"px","margin-left":d,"margin-top":s})})}var l=p[0].offsetWidth,r=p[0].offsetHeight,c=h.offsetWidth,f=h.offsetHeight,m=g[0].offsetWidth,u=g[0].offsetHeight;g[0].scrollLeft=i/l*(c-m),g[0].scrollTop=n/r*(f-u)}}});return void 0!==N?N:e}};"undefined"!=typeof module?module.exports=e:e()}("undefined"!=typeof global?global:this);