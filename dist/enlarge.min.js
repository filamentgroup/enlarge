/*! fg-enlarge - v0.3.1 - 2018-08-15
* Copyright (c) 2018 Scott Jehl, Filament Group, Inc.; Licensed MIT */

!function(j){var e=function(){var L=j.jQuery,R="enlarge";L.fn[R]=function(I){var N,O=arguments,F=L(this).data("options")||{button:!0,hoverZoomWithoutClick:!0,delay:300,flyout:{width:300,height:300},placement:"inline",magnification:3};"string"!=typeof I&&(F=L.extend(F,I),L(this).data("options",F));var e=this.each(function(){var o=L(this),a=this,e=j.document.createElement("img"),i="srcset"in e&&"sizes"in e,t=L(this).find("a");if(!t.length)throw new Error(R+": requires an anchor element with `href` for the enlarged image source");var n=o.find("img")[0],u=n,d=u.src,s=L(u).attr("srcset"),l=L(u).attr("sizes"),r=t[0].href,c=(t[0].innerText,R+"-zoomed"),f=R+"-delay",h=L(u).closest(".enlarge_contain"),p=h,m=L(u).closest(".enlarge_pane")||o,g=L(this).data("zoomParent")||m;L(this).data("zoomParent",g);var v=o.data("zoomed")||!1;o.data("zoomed",v),o.data("lockedZoom",o.data("lockedZoom")||!1);var y=R+"-locked";if(!h.length)throw new Error(R+": requires an element above the image marked with the class `enlarge_contain`");if("string"!=typeof I){var k,b,z,C;P(),o.data("updateOptions",function(e){F=L.extend(F,e),L(this).data("options",F),W(),_(),w=F.hoverZoomWithoutClick,F.image&&F.image.sizes&&(l=F.image.sizes,T()),P(),F.disabled&&o.data("zoomed")&&q()});var w=F.hoverZoomWithoutClick,Z=L('<div class="enlarge_flyout"></div>').append(h.clone());Z.insertAfter(m),h.append('<i class="enlarge_loader"><i></i></i>'),W(),_(),t.bind("keydown",function(e){var t;13!==e.keyCode&&32!==e.keyCode||"inline"!==(t=F.placement)&&(L(a).bind(R+".after-zoom-out",function e(){F.placement=t,W(),L(a).unbind(R+".after-zoom-out",e)}),F.placement="inline",W()),32===e.keyCode&&(e.preventDefault(),L(this).trigger("click"))}).bind("click",function(e){e.preventDefault(),q()}),L(j).bind("resize",function(e){o.data("lockedZoom")&&q()}),L(j.document).bind("mouseup",function(e){o.data("lockedZoom")&&!L(e.target).closest(m).length&&q()}),L(n).bind("mouseenter touchstart",function(e){"touchstart"===e.type&&(C=!0),C&&"mouseenter"===e.type||"mouseenter"===e.type&&!C&&!w||o.data("lockedZoom")||z||(z=!0,h.addClass(f),b=setTimeout(function(){h.removeClass(f),D(),T(function(){H(),k=!0,B(e)})},F.delay))}).bind("mousemove touchmove",B).bind("mouseleave touchend",function(e){var t;z=!1,v&&!o.data("lockedZoom")&&(D(),T(function(){H()})),t=e,h.removeClass(f),clearTimeout(b),(k=!1)!==F.hoverZoomWithoutClick||C||(w=!1),C&&"mouseleave"===t.type&&(C=!1)}).bind("click",function(e){e.preventDefault(),C&&"inline"===F.placement&&q(),!1!==F.hoverZoomWithoutClick||C||((w=!w)?L(this).trigger("mouseenter"):L(this).trigger("mouseleave"))}),L(this).bind("keydown keyup",function(e){37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode?(e.stopImmediatePropagation(),o.data("lockedZoom")||e.preventDefault()):"keyup"===e.type&&L(this).data("lockedZoom")&&27===e.keyCode&&(q(),t[0].focus(),e.stopImmediatePropagation())}),m.bind("scroll",function(){o.data("zoomed")&&(D(),T(function(){o.data("lockedZoom")&&A(),H()}))})}else{var x=Array.prototype.slice.call(O,1);switch(I){case"in":o.data("zoomed")||q();break;case"out":o.data("zoomed")&&q();break;case"isZoomed":N=o.data("zoomed");break;case"updateOptions":o.data("updateOptions")(x[0])}}function W(){"inline"===F.placement?(u=n,g=m,o.data("zoomParent",g),p=h):(u=Z.find("img")[0],g=p=Z,o.data("zoomParent",g))}function _(){Z.css({width:F.flyout.width+"px",height:F.flyout.height+"px",top:"",left:"","margin-left":"","margin-top":""});var e=F.placement.match(/left|right/);e&&(Z.css(e[0],-F.flyout.width-10+"px"),Z.css("top","0")),F.placement.match(/loupe/)&&Z.css({"margin-left":-F.flyout.width/2+"px","margin-top":-F.flyout.height/2+"px"}),Z[0].className=Z[0].className.replace(/enlarge_flyout\-[^$\s]+/," "),Z.addClass("enlarge_flyout-"+F.placement)}function P(){F.disabled?o.addClass("enlarge_disabled"):o.removeClass("enlarge_disabled")}function D(){v=!o.data("zoomed"),o.data("zoomed",v)}function T(e){if(e=e||function(){},v){if(F.disabled)return e(),!1;var t=new Image;t.className="enlarge_img-loading",t.onload=function(){u.sizes=t.sizes,i&&s||(u.src=r),L(t).remove(),e()},t.sizes=E()+"px",i&&s?s&&(t.srcset=s):t.src=r,L(t).insertBefore(u)}else u.sizes=l,i||(u.src=d),e()}function A(){if(o.data("lockedZoom"))m.add(g).removeClass(y),o.data("lockedZoom",lockedZoom=!1),p.removeAttr("tabindex");else{if(F.disabled)return!1;m.add(g).addClass(y),o.data("lockedZoom",lockedZoom=!0),p.attr("tabindex","0"),p[0].focus()}}function E(){return m[0].offsetWidth*F.magnification}function H(){if(o.data("zoomed")){if(F.disabled)return!1;"inline"===F.placement&&h.add(m).css({width:m[0].offsetWidth+"px",height:parseFloat(getComputedStyle(m[0]).height)+"px"}),g.addClass(c),L(u).css("width",E()+"px"),L(a).trigger(R+".after-zoom-in")}else g.removeClass(c),"inline"===F.placement&&h.add(m).css({width:"",height:""}),L(u).css("width",""),L(a).trigger(R+".after-zoom-out")}function q(){if(F.disabled&&!o.data("zoomed"))return!1;D(),T(function(){var e,t,o,a;A(),H(),e=p.width(),t=p.height(),o=u.offsetWidth,a=u.offsetHeight,p[0].scrollLeft=o/2-e/2,p[0].scrollTop=a/2-t/2})}function B(e){if(k){if(C&&"mousemove"===e.type)return;var t=e.originalEvent||e,o=t.touches?t.touches[0]:t;e.preventDefault();var a=o.clientX-h[0].getBoundingClientRect().left,i=o.clientY-h[0].getBoundingClientRect().top;if(F.placement.match(/loupe/)){var n=(t.touches?-F.flyout.width/1.3:-F.flyout.width/2)+"px",d=(t.touches?-F.flyout.height/1.3:-F.flyout.height/2)+"px";requestAnimationFrame(function(){Z.css({top:i+"px",left:a+"px","margin-left":n,"margin-top":d})})}var s=h[0].offsetWidth,l=h[0].offsetHeight,r=u.offsetWidth,c=u.offsetHeight,f=p[0].offsetWidth,m=p[0].offsetHeight;p[0].scrollLeft=a/s*(r-f),p[0].scrollTop=i/l*(c-m)}}});return void 0!==N?N:e}};"undefined"!=typeof module?module.exports=e:e()}("undefined"!=typeof global?global:this);